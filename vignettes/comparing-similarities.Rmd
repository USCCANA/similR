---
title: "Comparing Similarities and Distance"
author: "George G. Vega Yon"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Comparing Similarities and Distance}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction


```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.align = "center"
)
```

```{r loading-packages, echo=FALSE, message=FALSE}
library(ggplot2)
library(magrittr)
library(dplyr)
library(tidyr)
```


```{r loading-data}
library(similR)
data("powerset03")
data("powerset04")
data("statistics")
```

# Powerset of 3

```{r correlation-03, cache=FALSE}
# Computing 
all_raw03 <- similarity(powerset03, statistic = unlist(statistics))
all03 <- all_raw03
all03[!is.finite(all03)] <- NA

all_cor03 <- all03
all_cor03[,statistics$distance] <- -all_cor03[,statistics$distance]
all_cor03 <- cor(all_cor03[,-c(1,2)], use = "pairwise.complete.obs")
# knitr::kable(all_cor, digits = 2)
```

```{r correlation-plot-03, out.width="600px", fig.width=6, fig.height=6}
cbind(a=rownames(all_cor03), as.data.frame(all_cor03)) %>%
  gather(key = "b", value="corr", -a) %>%
  ggplot(aes(x=a, y=b, fill=corr))+
  scale_fill_distiller(palette = "RdBu") +
  geom_bin2d() +
  labs(fill     = "Correlation") +
  labs(title    = "Correlation between similarity statistics") +
  labs(subtitle = "(Distance was used as negative)") +
  theme(
    axis.text       = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    axis.title      = element_blank()
    )
```

```{r summary-stats-03}
all03 %>%
  as_tibble %>%
  select(-1,-2) %>%
  gather("Statistic", "Value") %>%
  group_by(Statistic) %>%
  summarize(
    `% Miss`    = sum(!is.finite(Value))/n()*100,
    `Variance`  = var(Value, na.rm=TRUE),
    `Min`       = min(Value, na.rm=TRUE),
    `Max`       = max(Value, na.rm=TRUE),
    `p25`       = quantile(Value, .25, na.rm=TRUE),
    `p75`       = quantile(Value, .75, na.rm=TRUE),
    `IQR`       = p75 - p25
  ) %>% 
  arrange(`% Miss`, desc(`Variance`)) %>%
  knitr::kable(digits=2)
```

Of all the measurements shown here, only 6 were defined for all cases. In the case of Anderberg, it might not be the best option because of its negatively correlatedness with most of the measures. Both Jaccard and Hamming, even though popular, show very low variances overall compare to Michael and Hamann, which if you care about heterogeneity in the measurements (this could be a key factor in regression analysis) can be important.


# Powerset of 4

We re-run the analysis but using the dataset `powerset04` wich contains `r length(powerset04)` unique binary networks, i.e. the powerset of graph size 4.

```{r correlation-04, cache=TRUE}
set.seed(122)
powerset04 <- sample(powerset04, 2000L)

# Computing
all_raw04 <- similarity(powerset04, statistic = unlist(statistics))
all04 <- all_raw04
all04[!is.finite(all04)] <- NA

all_cor04 <- all04
all_cor04[,statistics$distance] <- -all_cor04[,statistics$distance]
all_cor04 <- cor(all_cor04[,-c(1,2)], use = "pairwise.complete.obs")
# knitr::kable(all_cor, digits = 2)
```

```{r correlation-plot-04, out.width="600px", fig.width=6, fig.height=6}
cbind(a=rownames(all_cor04), as.data.frame(all_cor04)) %>%
  gather(key = "b", value="corr", -a) %>%
  ggplot(aes(x=a, y=b, fill=corr))+
  scale_fill_distiller(palette = "RdBu") +
  geom_bin2d() +
  labs(fill     = "Correlation") +
  labs(title    = "Correlation between similarity statistics") +
  labs(subtitle = "(Distance was used as negative)") +
  theme(
    axis.text       = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    axis.title      = element_blank()
    )
```

```{r summary-stats-04}
all04 %>%
  as_tibble %>%
  select(-1,-2) %>%
  gather("Statistic", "Value") %>%
  group_by(Statistic) %>%
  summarize(
    `% Miss`    = sum(!is.finite(Value))/n()*100,
    `Variance`  = var(Value, na.rm=TRUE),
    `Min`       = min(Value, na.rm=TRUE),
    `Max`       = max(Value, na.rm=TRUE),
    `p25`       = quantile(Value, .25, na.rm=TRUE),
    `p75`       = quantile(Value, .75, na.rm=TRUE),
    `IQR`       = p75 - p25
  ) %>%
  arrange(`% Miss`, desc(`Variance`)) %>%
  knitr::kable(digits=2)
```